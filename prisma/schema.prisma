generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model BaseTechnician {
  id           Int      @id @default(autoincrement())
  technicianId Int
  createdAt    DateTime @default(now())
}

model Calendar {
  id            Int             @id @default(autoincrement())
  name          String
  description   String?
  color         String          @default("#3b82f6")
  isVisible     Boolean         @default(true)
  isDefault     Boolean         @default(false)
  ownerId       String
  isPublic      Boolean         @default(false)
  timezone      String          @default("America/Sao_Paulo")
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  ScheduleEvent ScheduleEvent[]

  @@unique([ownerId, name])
}

model ChadaDiagnostic {
  id              String                @id
  itemId          Int
  sectorId        Int
  sectorName      String
  technicianChada String
  diagnostic      String
  requestedPart   String
  status          ChadaDiagnosticStatus @default(AGUARDANDO_PECA)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime
  completedAt     DateTime?
  createdBy       String
  Item            Item                  @relation(fields: [itemId], references: [id])
  School          School                @relation(fields: [sectorId], references: [id])
}

model EventParticipant {
  id            Int               @id @default(autoincrement())
  eventId       Int
  email         String
  name          String?
  role          ParticipantRole   @default(ATTENDEE)
  status        ParticipantStatus @default(PENDING)
  isOrganizer   Boolean           @default(false)
  canEdit       Boolean           @default(false)
  inviteSent    Boolean           @default(false)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime
  ScheduleEvent ScheduleEvent     @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, email])
  @@index([email])
  @@index([eventId])
}

model EventReminder {
  id            Int           @id @default(autoincrement())
  eventId       Int
  minutes       Int
  type          ReminderType  @default(POPUP)
  sent          Boolean       @default(false)
  createdAt     DateTime      @default(now())
  ScheduleEvent ScheduleEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
}

model InternalOS {
  id        Int      @id @default(autoincrement())
  setorId   String
  tecnicoId Int
  problema  String
  descricao String
  createdAt DateTime @default(now())
  email     String   @default("NÃ£o enviado")
  assinado  String?
  cpf       String?
  peca      String   @default("---------")
  status    String   @default("Pendente")
  updatedAt DateTime
}

model Item {
  id                Int                 @id @default(autoincrement())
  name              String
  brand             String
  serialNumber      String              @unique
  userId            String
  schoolId          Int?
  status            String              @default("DISPONIVEL")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  ChadaDiagnostic   ChadaDiagnostic[]
  School            School?             @relation(fields: [schoolId], references: [id])
  Profile           Profile             @relation(fields: [userId], references: [userId])
  ItemHistory       ItemHistory[]
  MemorandumItem    MemorandumItem[]
  NewMemorandumItem NewMemorandumItem[]
}

model ItemHistory {
  id          Int      @id @default(autoincrement())
  itemId      Int
  fromSchool  String
  toSchool    String
  movedAt     DateTime @default(now())
  generatedBy String?
  Item        Item     @relation(fields: [itemId], references: [id])

  @@index([itemId])
}

model ItemsChada {
  id             String           @id @default(uuid())
  itemId         Int
  problem        String
  userName       String
  status         ItemsChadaStatus @default(PENDENTE)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  setor          String
  updatedBy      String?
  osImages       Json[]
  emailMessageId String?
  emailSentAt    DateTime?
  numeroChadaOS  String?
}

model ItemsHistoryChada {
  id         Int      @id @default(autoincrement())
  itemId     Int
  resolvedBy String
  resolvedAt DateTime
  images     String[]
}

model Locados {
  id               Int      @id @default(autoincrement())
  name             String
  pcs              Int?
  notebooks        Int?
  tablets          Int?
  estabilizadores  Int?
  monitors         Int?
  impressoras      Int?
  name2            String?
  pcs2             Int?
  notebooks2       Int?
  tablets2         Int?
  estabilizadores2 Int?
  monitors2        Int?
  impressoras2     Int?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now())
}

model Memorandum {
  id             Int              @id @default(autoincrement())
  number         String           @unique
  schoolName     String
  district       String
  generatedBy    String
  type           String           @default("entrega")
  fromSchoolName String?
  toSchoolName   String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  MemorandumItem MemorandumItem[]
}

model MemorandumItem {
  id           Int        @id @default(autoincrement())
  memorandumId Int
  itemId       Int
  createdAt    DateTime   @default(now())
  Item         Item       @relation(fields: [itemId], references: [id])
  Memorandum   Memorandum @relation(fields: [memorandumId], references: [id])

  @@unique([memorandumId, itemId])
}

model NewMemorandum {
  id                Int                 @id @default(autoincrement())
  number            String              @unique
  schoolName        String
  district          String
  generatedBy       String
  type              String              @default("entrega")
  fromSchoolName    String?
  toSchoolName      String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  NewMemorandumItem NewMemorandumItem[]
}

model NewMemorandumItem {
  id            Int           @id @default(autoincrement())
  memorandumId  Int
  itemId        Int
  createdAt     DateTime      @default(now())
  Item          Item          @relation(fields: [itemId], references: [id])
  NewMemorandum NewMemorandum @relation(fields: [memorandumId], references: [id])

  @@unique([memorandumId, itemId])
}

model OSExterna {
  id                                 Int       @id @default(autoincrement())
  numeroOs                           String?   @unique
  data                               String
  hora                               String
  unidadeEscolar                     String?
  tecnicoResponsavel                 String?
  emailResponsavel                   String?
  fotosAntes                         String[]
  fotosDepois                        String[]
  pcsProprio                         Int?
  pcsLocado                          Int?
  notebooksProprio                   Int?
  notebooksLocado                    Int?
  monitoresProprio                   Int?
  monitoresLocado                    Int?
  estabilizadoresProprio             Int?
  estabilizadoresLocado              Int?
  tabletsProprio                     Int?
  tabletsLocado                      Int?
  pcsProprioOutrosLocais             Int?
  pcsLocadoOutrosLocais              Int?
  notebooksProprioOutrosLocais       Int?
  notebooksLocadoOutrosLocais        Int?
  monitoresProprioOutrosLocais       Int?
  monitoresLocadoOutrosLocais        Int?
  estabilizadoresProprioOutrosLocais Int?
  estabilizadoresLocadoOutrosLocais  Int?
  tabletsProprioOutrosLocais         Int?
  tabletsLocadoOutrosLocais          Int?
  pecasOuMaterial                    String?
  relatorio                          String?
  solicitacaoDaVisita                String?
  temLaboratorio                     Boolean?
  redeBr                             String?
  educacaoConectada                  String?
  naoHaProvedor                      String?
  rack                               Int?
  switch                             Int?
  roteador                           Int?
  oki                                Int?
  kyocera                            Int?
  hp                                 Int?
  ricoh                              Int?
  outrasImpressoras                  Int?
  solucionado                        String?
  status                             String    @default("Pendente")
  assinado                           String?
  cpf                                String?
  cargoResponsavel                   String?
  lastEmailSent                      DateTime?
  updatedAt                          DateTime
  createdAt                          DateTime  @default(now())
  diretoraNaEscola                   Boolean?
  impressoraComProblema              String?
  relatorioImpressora                String?
  temImpressoraComProblema           Boolean?
}

model OffTechnician {
  id           Int      @id @default(autoincrement())
  technicianId Int
  createdAt    DateTime @default(now())
}

model Os {
  id                        Int      @id @default(autoincrement())
  unidadeEscolar            String
  tecnicoResponsavel        String
  numeroOs                  String   @unique
  data                      String
  hora                      String
  notebooksOutroLocal       String
  tabletsOutroLocal         String
  solicitacaoDaVisita       String
  relatorio                 String
  pcsSieduca                String
  notebooksSieduca          String
  tabletsSieduca            String
  estabilizadoresSieduca    String
  naoHaSieduca              String
  dellSecretaria            String
  locadosSecretaria         String
  outrosSecretaria          String
  notebooksSecretaria       String
  tabletsSecretaria         String
  estabilizadoresSecretaria String
  dellOutroLocal            String
  locadosOutroLocal         String
  outrosOutroLocal          String
  estabilizadoresOutroLocal String
  naoHaOutroLocal           String
  redeBr                    String
  internetNasEscolas        String
  educacaoConectada         String
  naoHaProvedor             String
  rack                      String
  switch                    String
  roteador                  String
  oki                       String
  kyocera                   String
  hp                        String   @default("0")
  ricoh                     String   @default("0")
  outrasImpressoras         String
  solucionado               String
  emailResponsavel          String
  fotosAntes                String[]
  fotosDepois               String[]
  status                    String   @default("Pendente")
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @default(now())
}

model OsAssinada {
  id                        Int      @id @default(autoincrement())
  unidadeEscolar            String
  tecnicoResponsavel        String
  numeroOs                  String   @unique
  data                      String
  hora                      String
  notebooksOutroLocal       String
  tabletsOutroLocal         String
  solicitacaoDaVisita       String
  relatorio                 String
  pcsSieduca                String
  notebooksSieduca          String
  tabletsSieduca            String
  estabilizadoresSieduca    String
  naoHaSieduca              String
  dellSecretaria            String
  locadosSecretaria         String
  outrosSecretaria          String
  notebooksSecretaria       String
  tabletsSecretaria         String
  estabilizadoresSecretaria String
  dellOutroLocal            String
  locadosOutroLocal         String
  outrosOutroLocal          String
  estabilizadoresOutroLocal String
  naoHaOutroLocal           String
  redeBr                    String
  internetNasEscolas        String
  educacaoConectada         String
  naoHaProvedor             String
  rack                      String
  switch                    String
  roteador                  String
  oki                       String
  kyocera                   String
  hp                        String   @default("0")
  ricoh                     String   @default("0")
  outrasImpressoras         String
  solucionado               String
  emailResponsavel          String
  status                    String   @default("Pendente")
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime
  fotoAntes                 String?
  fotoDepois                String?
  nameAssigned              String
  cpfOrRegistration         String
  fotosAntes                String[]
  fotosDepois               String[]
}

model Printer {
  id            Int             @id @default(autoincrement())
  sigla         String
  setor         String
  modelo        String
  fabricante    String
  serial        String          @unique
  ip            String
  PrinterStatus PrinterStatus[]
}

model PrinterStatus {
  id                Int      @id @default(autoincrement())
  printerId         Int
  status            String
  errorState        String
  errors            Json
  errorDetails      Json
  tonerLevel        Int?
  paperStatus       String
  isOnline          Boolean
  uptime            String?
  pageCount         Int?
  hasCriticalErrors Boolean  @default(false)
  responseTime      Int?
  lastChecked       DateTime @default(now())
  updatedAt         DateTime
  Printer           Printer  @relation(fields: [printerId], references: [id])

  @@index([printerId])
  @@index([updatedAt])
}

model Profile {
  id          Int     @id @default(autoincrement())
  userId      String  @unique
  displayName String
  photoUrl    String?
  role        Role    @default(TECH)
  schoolId    Int     @default(225)
  Item        Item[]
  School      School  @relation(fields: [schoolId], references: [id])
}

model RouteOptimization {
  id            String       @id
  technicianId  Int
  date          DateTime
  totalDistance Float?
  totalTime     Int?
  optimized     Boolean      @default(false)
  algorithm     String?
  startLocation Json?
  notes         String?
  status        RouteStatus  @default(PLANNED)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  RouteVisit    RouteVisit[]

  @@index([status])
  @@index([technicianId, date])
}

model RouteVisit {
  id                String            @id
  routeId           String
  schoolId          Int
  visitOrder        Int
  estimatedTime     Int
  actualTime        Int?
  arrivalTime       DateTime?
  departureTime     DateTime?
  distance          Float?
  status            VisitStatus       @default(PENDING)
  notes             String?
  RouteOptimization RouteOptimization @relation(fields: [routeId], references: [id], onDelete: Cascade)
  School            School            @relation(fields: [schoolId], references: [id])

  @@index([routeId, visitOrder])
  @@index([schoolId])
  @@index([status])
}

model ScheduleEvent {
  id                  Int                @id @default(autoincrement())
  title               String
  description         String?
  startDate           DateTime
  endDate             DateTime
  allDay              Boolean            @default(false)
  type                EventType          @default(TASK)
  priority            Priority           @default(MEDIUM)
  status              EventStatus        @default(PENDING)
  createdBy           String
  assignedTo          String?
  location            String?
  schoolId            Int?
  calendarId          Int
  recurring           Boolean            @default(false)
  recurrence          Json?
  parentEventId       Int?
  isException         Boolean            @default(false)
  attachments         String[]
  tags                String[]
  timezone            String             @default("America/Sao_Paulo")
  url                 String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime
  EventParticipant    EventParticipant[]
  EventReminder       EventReminder[]
  Calendar            Calendar           @relation(fields: [calendarId], references: [id], onDelete: Cascade)
  ScheduleEvent       ScheduleEvent?     @relation("ScheduleEventToScheduleEvent", fields: [parentEventId], references: [id])
  other_ScheduleEvent ScheduleEvent[]    @relation("ScheduleEventToScheduleEvent")
  School              School?            @relation(fields: [schoolId], references: [id])
  TechnicalTicket     TechnicalTicket[]

  @@index([assignedTo])
  @@index([calendarId])
  @@index([createdBy])
  @@index([parentEventId])
  @@index([startDate, endDate])
}

model School {
  id               Int                @id @default(autoincrement())
  name             String             @unique
  inep             Int                @default(0)
  district         String?
  address          String?
  director         String?
  phone            String?
  email            String?
  students         Int?               @default(0)
  laboratorio      Int?               @default(0)
  parentSchoolId   Int?
  geocoded         Boolean            @default(false)
  latitude         Float?
  longitude        Float?
  ChadaDiagnostic  ChadaDiagnostic[]
  Item             Item[]
  Profile          Profile[]
  RouteVisit       RouteVisit[]
  ScheduleEvent    ScheduleEvent[]
  School           School?            @relation("SchoolToSchool", fields: [parentSchoolId], references: [id])
  other_School     School[]           @relation("SchoolToSchool")
  SchoolDemand     SchoolDemand[]
  TechnicalTicket  TechnicalTicket[]
  chamados_escola  chamados_escola[]
  internal_tickets internal_tickets[]

  @@index([geocoded])
}

model SchoolDemand {
  id        Int      @id @default(autoincrement())
  schoolId  Int
  demand    String
  createdAt DateTime @default(now())
  School    School   @relation(fields: [schoolId], references: [id])
}

model ServiceOrder {
  id                             Int       @id @default(autoincrement())
  orderNumber                    String
  visitDate                      DateTime?
  visitTime                      String
  school                         String
  visitResponsible               String
  visitResponsibleRole           String
  visitObjective                 String
  technicians                    String[]
  sieducaDetails                 String[]
  sieducaEquipmentDetails        String?
  secretaryDetails               String[]
  secretaryEquipmentDetails      String?
  otherLocationsDetails          String[]
  otherLocationsEquipmentDetails String?
  internetDetails                String[]
  rackDetails                    String[]
  rackEquipmentDetails           String?
  printerDetails                 String[]
  printerEquipmentDetails        String?
  visitDescription               String
  repairDescription              String
  problemSolved                  String
  reasonNotSolved                String?
  nextTechnicianInstructions     String?
  beforePhotos                   String[]
  afterPhotos                    String[]
  completionDate                 DateTime
  completionTime                 String
  completionResponsible          String
  signedPhoto                    String[]
}

model TechnicalTicket {
  id                Int             @id @default(autoincrement())
  schoolId          Int
  title             String
  description       String
  priority          TicketPriority?
  category          TicketCategory  @default(OTHER)
  equipmentAffected String?
  status            TicketStatus    @default(OPEN)
  createdBy         String
  assignedTo        String?
  scheduledDate     DateTime?
  scheduledTime     String?
  eventId           Int?
  notes             String?
  attachments       String[]
  deletedAt         DateTime?
  deletedBy         String?
  deletionReason    String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  ScheduleEvent     ScheduleEvent?  @relation(fields: [eventId], references: [id])
  School            School          @relation(fields: [schoolId], references: [id])
  TicketComment     TicketComment[]

  @@index([assignedTo])
  @@index([createdAt])
  @@index([schoolId])
  @@index([status])
}

model TicketComment {
  id              Int             @id @default(autoincrement())
  ticketId        Int
  authorId        String
  authorName      String
  authorRole      String
  content         String
  isInternal      Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  TechnicalTicket TechnicalTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([ticketId])
}

model User {
  id       Int    @id @default(autoincrement())
  email    String @unique
  password String
  name     String
}

model VisitTechnician {
  id           Int      @id @default(autoincrement())
  technicianId Int
  createdAt    DateTime @default(now())
}

model chamados_escalas {
  id              Int       @id @default(autoincrement())
  escola          String
  titulo          String
  descricao       String
  categoria       String
  tecnico         String
  osOriginal      String?
  automatico      Boolean   @default(false)
  status          String    @default("PENDENTE")
  dataCriacao     DateTime  @default(now())
  dataAgendamento DateTime?
  observacoes     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
}

model chamados_escola {
  id          String          @id
  schoolId    Int
  schoolName  String
  title       String
  description String
  category    ChamadoCategory @default(OTHER)
  priority    ChamadoPriority @default(MEDIUM)
  status      ChamadoStatus   @default(OPEN)
  phone       String?
  contact     String?
  createdBy   String
  assignedTo  String?
  notes       String?
  resolvedAt  DateTime?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime
  School      School          @relation(fields: [schoolId], references: [id])

  @@index([assignedTo])
  @@index([createdAt])
  @@index([schoolId])
  @@index([status])
}

model internal_chat_messages {
  id               Int              @id @default(autoincrement())
  ticketId         Int
  senderId         String
  senderName       String
  senderType       String
  content          String
  attachments      String[]
  sentAt           DateTime         @default(now())
  readAt           DateTime?
  internal_tickets internal_tickets @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([sentAt])
  @@index([ticketId])
}

model internal_tickets {
  id                     Int                      @id @default(autoincrement())
  schoolId               Int
  title                  String
  description            String?
  category               InternalTicketCategory   @default(OTHER)
  priority               InternalTicketPriority   @default(NORMAL)
  status                 InternalTicketStatus     @default(OPEN)
  assignedTo             String?
  assignedName           String?
  closedAt               DateTime?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  internal_chat_messages internal_chat_messages[]
  School                 School                   @relation(fields: [schoolId], references: [id])

  @@index([assignedTo])
  @@index([createdAt])
  @@index([schoolId])
  @@index([status])
}

enum ChadaDiagnosticStatus {
  AGUARDANDO_PECA
  PECA_CHEGOU
  INSTALADO
  CANCELADO
}

enum ChamadoCategory {
  COMPUTER
  NOTEBOOK
  TABLET
  PRINTER
  NETWORK
  SOFTWARE
  MAINTENANCE
  PHONE
  PROJECTOR
  AUDIO
  OTHER
}

enum ChamadoPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ChamadoStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  RESOLVED
  CLOSED
  CANCELLED
}

enum EventStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum EventType {
  TASK
  MEETING
  APPOINTMENT
  REMINDER
  DEADLINE
  MAINTENANCE
}

enum InternalTicketCategory {
  COMPUTER
  NOTEBOOK
  TABLET
  PRINTER
  NETWORK
  SOFTWARE
  PHONE
  MAINTENANCE
  ACCESS
  OTHER
}

enum InternalTicketPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum InternalTicketStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  WAITING
  RESOLVED
  CLOSED
  CANCELLED
}

enum ItemsChadaStatus {
  PENDENTE
  RESOLVIDO
  RECEBIDO
  EM_ANALISE
  CONSERTADO
  SEM_CONSERTO
  DEVOLVIDO
}

enum ParticipantRole {
  ORGANIZER
  ATTENDEE
  OPTIONAL
  RESOURCE
}

enum ParticipantStatus {
  PENDING
  ACCEPTED
  DECLINED
  TENTATIVE
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ReminderType {
  POPUP
  EMAIL
  SMS
  PUSH
}

enum Role {
  ADMIN
  TECH
  ONLYREAD
  ADMTOTAL
  SCHOOL
}

enum RouteStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TicketCategory {
  COMPUTER
  NOTEBOOK
  TABLET
  PRINTER
  NETWORK
  SOFTWARE
  MAINTENANCE
  OTHER
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TicketStatus {
  OPEN
  ASSIGNED
  SCHEDULED
  IN_PROGRESS
  RESOLVED
  CLOSED
  CANCELLED
  DELETED
}

enum VisitStatus {
  PENDING
  TRAVELING
  ARRIVED
  WORKING
  COMPLETED
  SKIPPED
}
